# Документация OID (вид клиента)

Описание OID агента SNMP: какой ответ возвращается на GET и какой формат данных ожидается при SET. Все объекты доступны для чтения (GET) и записи (SET), если не оговорено иное.

---

## 1. OID дерева 1.3.6.1.4.1.1618 (основной протокол)

### 1.1 Режим и идентификация

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.1618.3.7.2.10.1.0** | Локальный режим контроллера | `0` — не в локальном режиме (выполняет команды протокола)<br>`1` — в локальном режиме | INTEGER | Запись не меняет режим; ответ как при GET |
| **1.3.6.1.2.1.1.5.0** | Идентификатор устройства | Значение UID из конфигурации SNMP | INTEGER | Запись не меняет значение; возвращается текущий UID |

### 1.2 Параметры конфигурации

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.1618.3.5.2.1.5.0** | Количество сигнальных групп | Число сигнальных групп | INTEGER | Запись не меняет значение; возвращается текущее количество |
| **1.3.6.1.4.1.1618.3.5.2.1.7.0** | Номер плана | Номер текущего плана координации | INTEGER | Запись не меняет значение; возвращается текущий номер плана |
| **1.3.6.1.4.1.1618.3.7.2.1.3.0** | Источник плана | Код источника: 0 — локальное, 1 — внешнее по группам, 2 — внешнее по планам, 3 — ручное | INTEGER | Запись не меняет значение; возвращается текущий источник |

### 1.3 Состояние контроллера

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.1618.3.6.2.1.2.0** | Основное состояние контроллера (major state) | Код основного состояния | INTEGER | Запись не меняет значение; возвращается текущее состояние |
| **1.3.6.1.4.1.1618.3.6.2.2.2.0** | Состояние устройства | Код состояния устройства | INTEGER | Запись не меняет значение; возвращается текущее состояние |
| **1.3.6.1.4.1.1618.3.7.2.11.2.0** | Номер фазы | Номер текущей фазы | INTEGER | Запись не меняет значение; возвращается текущая фаза |
| **1.3.6.1.4.1.1618.3.5.2.1.3.0** | Номер фазы (альт.) | Номер текущей фазы | INTEGER | Запись не меняет значение; возвращается текущая фаза |
| **1.3.6.1.4.1.1618.3.7.2.11.2.1.0** | Наличие промтакта | `0` — нет промтакта<br>`1` — есть промтакт | INTEGER | Запись не меняет значение; возвращается текущее значение |
| **1.3.6.1.4.1.1618.3.5.2.1.6.0** | Состояние сигнальных групп | Массив состояний по направлениям: коды 0–11 (см. раздел 5) | OCTET STRING / массив целых | Запись не меняет значение; возвращается текущее состояние |

### 1.4 Тревоги (алармы)

Три OID возвращают строки кодов ошибок по трём байтам статуса КДМ (события: нет предупреждений, лампа сгорела, нет часов, нет GPS, нет платы и т.д.).

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.1618.3.1.2.2.2.0** | Тревоги (байт 0) | Строка кода ошибки по первому байту статуса | OCTET STRING | Запись не меняет значение; возвращается текущий код |
| **1.3.6.1.4.1.1618.3.1.2.2.3.0** | Тревоги (байт 1) | Строка по второму байту статуса (или 0) | OCTET STRING | Запись не меняет значение; возвращается текущее значение |
| **1.3.6.1.4.1.1618.3.1.2.2.4.0** | Тревоги (байт 2) | Строка по третьему байту статуса (или 0) | OCTET STRING | Запись не меняет значение; возвращается текущее значение |

### 1.5 Команды центра (SET выполняет команду)

GET возвращает текущее состояние (план, фаза, ОС, КК, ЖМ). При SET: для КК, ОС, ЖМ в ответе возвращается **переданное значение**; для фазы и плана — **текущая фаза/план** после выполнения команды.

| OID | Описание | GET — ответ | Формат ответа | SET — значение и ответ |
|-----|----------|-------------|---------------|---------------------------|
| **1.3.6.1.4.1.1618.3.2.2.4.1.0** | Установить КК (красный конфликт) | `0` — КК не установлен<br>`2` — КК установлен | INTEGER (Unsigned32) | `0` — снять КК; иначе — установить КК. **Ответ:** переданное значение |
| **1.3.6.1.4.1.1618.3.2.2.2.1.0** | Установить ОС (отключение светофоров) | `0` — ОС не установлено<br>`2` — ОС | INTEGER (Unsigned32) | `0` — снять ОС; иначе — установить ОС. **Ответ:** переданное значение |
| **1.3.6.1.4.1.1618.3.2.2.1.1.0** | Установить ЖМ (жёлтый мигающий) | `0` — ЖМ не установлен<br>`2` — ЖМ | INTEGER (Unsigned32) | `0` — снять ЖМ; иначе — установить ЖМ. **Ответ:** переданное значение |
| **1.3.6.1.4.1.1618.3.2.2.1.2.0** | Установить ЖМ (дубликат) | Как у 1.2.1.1.0 | INTEGER (Unsigned32) | Как у 1.2.1.1.0. **Ответ:** переданное значение |
| **1.3.6.1.4.1.1618.3.7.2.11.1.0** | Установить фазу | Текущий номер фазы | INTEGER | `0` — снять управление по фазе; ненулевое — переключение на фазу. При ВПУ команда не выполняется. **Ответ:** текущая фаза |
| **1.3.6.1.4.1.1618.3.7.2.2.1.0** | Установить план | Текущий номер плана | INTEGER | Номер плана — переключение на план; `0` — снять управление. **Ответ:** текущий план |
| **1.3.6.1.4.1.1618.3.7.2.1.2.0** | Номер текущего плана (PlanNumber) | Номер текущего плана | INTEGER | Запись не меняет значение; в ответе — текущий план |

### 1.6 Время и метки

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.1206.4.2.6.3.1.0** | Время/дата (Unix) | Текущее время (32‑битный счётчик, Unix timestamp) | Counter32/число секунд | SET: значение — Unix timestamp. **Ответ при SET:** переданное значение |
| **1.3.6.1.4.1.1618.3.7.2.2.3.0** | Момент установки плана | Текущее время (Unix timestamp) | Unsigned32 | **Ответ при SET:** переданное значение |
| **1.3.6.1.4.1.1618.3.7.2.2.2.0** | Признак установки плана | Всегда `1` | Unsigned32 | **Ответ при SET:** переданное значение |
| **1.3.6.1.4.1.1618.3.5.2.1.1.0** | Запрос времени 1 | Текущее время (Unix timestamp) | Unsigned32 | Запись не меняет значение; возвращается текущее время |
| **1.3.6.1.4.1.1618.3.6.2.1.1.0** | Запрос времени 2 | Текущее время (Unix timestamp) | Unsigned32 | Запись не меняет значение; возвращается текущее время |
| **1.3.6.1.4.1.1618.3.6.2.2.1.0** | Запрос времени 3 | Текущее время (Unix timestamp) | Unsigned32 | Запись не меняет значение; возвращается текущее время |

### 1.7 Причина основного состояния

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.1618.3.6.2.1.3.0** | Причина основного состояния контроллера | Всегда `0` | INTEGER | Запись не меняет значение; возвращается 0 |

### 1.8 Подписки и таблицы

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.1618.2.2.1.1.1.0** | Текущая таблица подписок | `nil` (пусто) | — | При SET возвращается переданное значение как Unsigned32 |

### 1.9 Расширения (stcip)

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.1618.3.11.1.0** | Версия поддерживаемых расширений | `2` (поддержка v1 и v2) | INTEGER | Запись не меняет значение; возвращается 2 |
| **1.3.6.1.4.1.1618.3.11.2.1.1.0** | Таймаут перехода в ЛКУ при потере связи (сек) | Текущее значение таймаута (секунды); `0` — не переходить | Unsigned32 | SET: таймаут в секундах. **Ответ при SET:** переданное значение |
| **1.3.6.1.4.1.1618.3.11.2.3.1.0** | Версия ПО контроллера | Строка типа/версии КДМ (например, «ELC2_v4.2.1») | STRING (OCTET STRING) | Запись не меняет значение; в ответе всегда текущая строка |
| **1.3.6.1.4.1.1618.3.11.2.3.2.0** | Версия ПО адаптера/прокси | Строка вида «potop to &lt;дата&gt;» | STRING | Запись не меняет значение; в ответе всегда эта строка |
| **1.3.6.1.4.1.1618.3.11.2.7.1.0** | Дверь шкафа | `0` — закрыто<br>`1` — открыто | INTEGER | SET не меняет физическое состояние. **Ответ при SET:** переданное значение |
| **1.3.6.1.4.1.1618.3.11.2.8.1.0** | Количество доступных планов | Максимальный номер плана из конфигурации (минимум 1) | INTEGER | **Ответ при SET:** переданное значение |

---

## 2. OID дерева 1.3.6.1.4.1.13267 (UG405)

### 2.1 Время и версия

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.13267.3.2.3.2.0** | Текущее время | Строка в формате `19700101000000Z` (ISO-подобный) | STRING | Установка времени; при GET после SET — актуальное время в том же формате |
| **1.3.6.1.4.1.13267.3.2.3.2** | То же (без .0) | То же | STRING | То же |
| **1.3.6.1.4.1.13267.3.2.2.1.0** | Дата последнего изменения конфигурации ДК | Строка даты/времени (формат как у времени) | STRING | Запись не меняет значение; возвращается дата деплоя |
| **1.3.6.1.4.1.13267.3.2.2.1** | То же (без .0) | То же | STRING | То же |
| **1.3.6.1.4.1.13267.3.2.1.2.0** | Версия контроллера | Строка версии (например, `0.0.1`) | STRING | Запись не меняет значение; возвращается версия |
| **1.3.6.1.4.1.13267.3.2.1.2** | То же (без .0) | То же | STRING | То же |

### 2.2 Режим работы ДК

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.13267.3.2.4.1.0** | Режим работы ДК | `1` — локальная адаптивная или локальный фикс-тайм<br>`2` — сервисный режим<br>`3` — удалённое управление | INTEGER | `1` — локальный источник, счётчик 0<br>`2` — ручное управление<br>`3` — центральные планы (удалённое управление) |
| **1.3.6.1.4.1.13267.3.2.4.1** | То же (без .0) | То же | INTEGER | То же |

### 2.3 Фаза, ЖМ, ОС, КК

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.13267.3.2.5.1.1.3** | Фаза (чтение строкой) | Строка текущей фазы (после преобразования из номера КДМ) | STRING | — |
| **1.3.6.1.4.1.13267.3.2.4.2.1.5** | Установка фазы строкой | То же | STRING | Строка фазы: переключение на фазу (источник — центр); при автономии запись игнорируется |
| **1.3.6.1.4.1.13267.3.2.4.2.1.20** | Состояние ЖМ | Код состояния мигающего жёлтого | INTEGER | Включить/выключить ЖМ; `0` — выключить ЖМ, план 0, локальный источник |
| **1.3.6.1.4.1.13267.3.2.5.1.1.36** | То же (альт.) | То же | INTEGER | То же |
| **1.3.6.1.4.1.13267.3.2.4.2.1.11** | Состояние ОС (выключение) | Код состояния «выключено» | INTEGER | Включить/выключить ОС; `0` — выключить ОС, план 0, локальный источник |
| **1.3.6.1.4.1.13267.3.2.5.1.1.45** | То же (альт.) | То же | INTEGER | То же |
| **1.3.6.1.4.1.13267.3.2.2.4.1.0** | Состояние КК | Код КК (AllRed) | INTEGER | Установить/снять КК; `0` — снять КК, план 0, локальный источник |

### 2.4 Режим адаптивный/фиксированный и управление

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.13267.3.2.5.1.1.46** | Режим: фикс / адаптив | `0` — адаптивный<br>`1` — фиксированный | INTEGER | `0` — адаптивный, команда КДМ 1.0, локальный источник<br>другое — фиксированный, источник UG405 удалённый |
| **1.3.6.1.4.1.13267.3.2.5.1.1.15** | Локальный режим (управление бит) | `0` / `1` — выполняет ли команды протокола | INTEGER | Установка бита управления |
| **1.3.6.1.4.1.13267.3.2.4.2.1.15** | Включить/выключить управление | Текущее значение бита управления | INTEGER | `0` — выключить управление (КДМ фаза 0, план 0, локальный источник) |

### 2.5 Ошибки и диагностика

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.13267.3.2.5.1.1.16** | Ошибка ДК | `0` — нет ошибок<br>`1` — есть ошибки | INTEGER | Запись не меняет значение; возвращается текущий статус |
| **1.3.6.1.4.1.13267.3.2.5.1.1.16.1** | Ошибки аппаратного обеспечения ДК | `0` / `1` | INTEGER | Запись не меняет значение |
| **1.3.6.1.4.1.13267.3.2.5.1.1.16.2** | Ошибки ПО ДК | `0` / `1` | INTEGER | Запись не меняет значение |
| **1.3.6.1.4.1.13267.3.2.5.1.1.16.3** | Ошибки сетей (энерго) ДК | `0` / `1` | INTEGER | Запись не меняет значение |
| **1.3.6.1.4.1.13267.3.2.5.1.1.5** | Ошибка детекторов | Всегда `0` | INTEGER | Запись не меняет значение |

### 2.6 План и источник плана

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.13267.1.2.9.1.3** | Текущий план | Номер текущего плана | INTEGER | Номер плана — переключение на план (при неавтономном режиме). Ответ — текущий план |
| **1.3.6.1.4.1.13267.1.2.9.1.3.1** | Причина включения плана | `1` — по расписанию<br>`2` — удалённо по SNMP<br>`3` — панели или веб | INTEGER | Запись не меняет значение; возвращается переданное значение |

### 2.7 Такт, ВПУ, детекторы

| OID | Описание | GET — ответ | Формат ответа | SET |
|-----|----------|-------------|---------------|-----|
| **1.3.6.1.4.1.13267.3.2.5.1.1.3.1** | Текущий такт (промтакт) | Значение в шестнадцатеричной строке | STRING (hex) | Запись не меняет значение; возвращается текущий такт |
| **1.3.6.1.4.1.13267.3.2.5.1.1.15** | Управление ВПУ | Всегда `0` | INTEGER | Запись не меняет значение |
| **1.3.6.1.4.1.13267.3.2.3.1** | Количество используемых детекторов | Целое — счётчик детекторов | INTEGER | Запись не меняет значение; возвращается текущий счётчик |

---

## 3. Краткая сводка типов ответов

| Тип в документе | SNMP-тип | Пример |
|-----------------|----------|--------|
| INTEGER | Integer32 / INTEGER | 0, 1, 2 |
| Unsigned32 | Unsigned32 / Gauge32 | 0, 1, 12345 |
| Counter32 / TimeTicks | Counter32, TimeTicks | Unix timestamp |
| OCTET STRING | Octet String | Строка байтов (коды ошибок) |
| STRING | Octet String (UTF-8/ASCII) | "potop to 20260204", "0.0.1" |
| STRING (hex) | Octet String | Шестнадцатеричное представление такта |

---

## 4. Замечания для клиента

- Все OID доступны для GET и SET. На части объектов SET не меняет состояние; в ответе возвращается текущее или переданное значение (см. таблицы).
- Команды управления (КК, ОС, ЖМ, фаза, план) выполняются только при неавтономном режиме контроллера. В автономном режиме SET может не выполниться; в ответ приходит текущее состояние.
- Время в OID 1.3.6.1.4.1.1206.4.2.6.3.1.0 и в полях «запрос времени» — Unix timestamp (секунды с 01.01.1970 UTC).
- Тревоги (раздел 1.4) возвращаются как OCTET STRING (коды по байтам статуса КДМ).

---

## 5. Состояние сигнальных групп (OID 1.3.6.1.4.1.1618.3.5.2.1.6.0). Структура ответа

Ответ — массив состояний по направлениям (сигнальным группам). Каждый элемент — целое число (код состояния) от 0 до 11.

**Коды состояний направлений:**

| Код | Значение |
|-----|----------|
| 0 | OFF — все сигналы выключены |
| 1 | DEACTIV_YELLOW — неактивное состояние, жёлтый после зелёного |
| 2 | DEACTIV_RED — неактивное состояние, красный |
| 3 | ACTIV_RED — активное состояние, красный |
| 4 | ACTIV_REDYELLOW — активное состояние, красный с жёлтым |
| 5 | ACTIV_GREEN — активное состояние, зелёный |
| 6 | UNCHANGE_GREEN — состояние не менялось, зелёный |
| 7 | UNCHANGE_RED — состояние не менялось, красный |
| 8 | GREEN_BLINK — зелёный мигающий |
| 9 | ZM_YELLOW_BLINK — жёлтый мигающий в режиме ЖМ |
| 10 | OS_OFF — сигналы выключены в режиме ОС |
| 11 | UNUSED — неиспользуемое направление |

**Пример ответа в JSON:**

```json
{
  "oid": "1.3.6.1.4.1.1618.3.5.2.1.6.0",
  "name": "Состояние сигнальных групп",
  "value": [5, 3, 3, 6, 3, 7, 11, 11],
  "statusDirs": [
    { "index": 0, "code": 5, "label": "ACTIV_GREEN" },
    { "index": 1, "code": 3, "label": "ACTIV_RED" },
    { "index": 2, "code": 3, "label": "ACTIV_RED" },
    { "index": 3, "code": 6, "label": "UNCHANGE_GREEN" },
    { "index": 4, "code": 3, "label": "ACTIV_RED" },
    { "index": 5, "code": 7, "label": "UNCHANGE_RED" },
    { "index": 6, "code": 11, "label": "UNUSED" },
    { "index": 7, "code": 11, "label": "UNUSED" }
  ]
}
```

Минимальный вариант (только массив кодов):

```json
{
  "oid": "1.3.6.1.4.1.1618.3.5.2.1.6.0",
  "value": [5, 3, 3, 6, 3, 7, 11, 11]
}
```

При SET на этот OID состояние не меняется; в ответе возвращается текущее значение в том же формате.

---

## 6. Примеры ответов в JSON: фаза, план, версия контроллера

Ниже — структура ответов в формате JSON для OID, возвращающих номер фазы, номер плана и строку версии/типа контроллера.

### 6.1 Номер фазы

**OID (примеры):** 1.3.6.1.4.1.1618.3.7.2.11.2.0, 1.3.6.1.4.1.1618.3.5.2.1.3.0, 1.3.6.1.4.1.1618.3.7.2.11.1.0 (GET/SET ответ).

**Ответ — целое число (номер текущей фазы КДМ).** Пример в JSON:

```json
{
  "oid": "1.3.6.1.4.1.1618.3.7.2.11.2.0",
  "name": "Номер фазы",
  "value": 3,
  "phase": 3
}
```

Вариант с меткой времени (как в протоколе обмена):

```json
{
  "oid": "1.3.6.1.4.1.1618.3.7.2.11.2.0",
  "time": "14:32:05",
  "phase": 3,
  "value": 3
}
```

### 6.2 Номер плана

**OID (примеры):** 1.3.6.1.4.1.1618.3.5.2.1.7.0, 1.3.6.1.4.1.1618.3.7.2.2.1.0, 1.3.6.1.4.1.1618.3.7.2.1.2.0, 1.3.6.1.4.1.13267.1.2.9.1.3.

**Ответ — целое число (номер текущего плана координации).** Пример в JSON:

```json
{
  "oid": "1.3.6.1.4.1.1618.3.5.2.1.7.0",
  "name": "Номер плана",
  "value": 5,
  "plan": 5
}
```

Вариант с меткой времени:

```json
{
  "oid": "1.3.6.1.4.1.1618.3.7.2.2.1.0",
  "time": "14:32:05",
  "plan": 5,
  "value": 5
}
```

Расширенный вариант (план + состояние контроллера, по аналогии с Message 190): возможные значения `status`: "NO COMMAND", "LOCAL", "CENTRAL", "FLASHING", "ALL RED", "MANUAL", "DARK", "RUN PLAN N".

```json
{
  "oid": "1.3.6.1.4.1.1618.3.5.2.1.7.0",
  "plan": 5,
  "value": 5,
  "status": "RUN PLAN 5",
  "statusCode": 7,
  "basic": 0
}
```

### 6.3 Версия / тип ПО контроллера

**OID:** 1.3.6.1.4.1.1618.3.11.2.3.1.0 (stcipControllerSwVersion).

**Ответ — строка (тип и/или версия КДМ).** Примеры в JSON:

```json
{
  "oid": "1.3.6.1.4.1.1618.3.11.2.3.1.0",
  "name": "Версия ПО контроллера",
  "value": "ELC2_v4.2.1"
}
```

Вариант с явным полем типа (значения зависят от типа устройства, например «КДМ ИТС3», «Инспектор ИТС3», «Инспектор ИТС3-96»):

```json
{
  "oid": "1.3.6.1.4.1.1618.3.11.2.3.1.0",
  "value": "КДМ ИТС3",
  "type": "КДМ ИТС3"
}
```

Минимальный ответ (только значение):

```json
{
  "oid": "1.3.6.1.4.1.1618.3.11.2.3.1.0",
  "value": "ELC2_v4.2.1"
}
```
